from astropy import units as u
import numpy as np

wfi_filters = 'F062 F087 F106 F129 F158 F184 F213 F146'.split()
wfi_filters_alt = 'R062 Z087 Y106 J129 H158 F184 K213 W146'.split()


# Values taken from here (last updated June 2024):https://github.com/spacetelescope/roman-technical-information/blob/main/data/WideFieldInstrument/Imaging/ZodiacalLight/zodiacal_light.ecsv
wfi_minzodi_background = {'F062':0.25,'F087':0.251, 'F106':0.277, 'F129':0.267, 'F158':0.244, 'F184':0.141, 'F213':0.118, 'F146':0.781}


# Values taken from here (last updated June 2024): https://github.com/spacetelescope/roman-technical-information/blob/main/data/WideFieldInstrument/Imaging/Backgrounds/internal_thermal_backgrounds.ecsv
wfi_thermal_background={'F062':0.003,'F087':0.003, 'F106':0.003, 'F129':0.003, 'F158':0.048, 'F184':0.155, 'F213':4.38, 'F146':1.03}


# Zeropoint Magnitudes taken and calculated from effective area tables here (last updated March 2024): https://github.com/spacetelescope/roman-technical-information/tree/main/data/WideFieldInstrument/Imaging/EffectiveAreas
wfi_filter_zeropoint_mags= {'SCA01': {'F062': 26.575584953147047,
  'F087': 26.22630837285709,
  'F106': 26.31528009887738,
  'F129': 26.319467810686117,
  'F158': 26.322576158444306,
  'F184': 25.854667721880524,
  'F146': 27.53861667037689,
  'F213': 25.81500462590912},
 'SCA02': {'F062': 26.606941394692786,
  'F087': 26.29818407774948,
  'F106': 26.351737958432192,
  'F129': 26.338676275129256,
  'F158': 26.369426616084596,
  'F184': 25.912950481390222,
  'F146': 27.577660642304814,
  'F213': 25.85726796291789},
 'SCA03': {'F062': 26.601380484788,
  'F087': 26.283202418675778,
  'F106': 26.336740574764438,
  'F129': 26.334453256821305,
  'F158': 26.35937269396861,
  'F184': 25.910849276892733,
  'F146': 27.566296458008495,
  'F213': 25.85433161025479},
 'SCA04': {'F062': 26.541362602616,
  'F087': 26.270355519303102,
  'F106': 26.330118546652805,
  'F129': 26.328797581246562,
  'F158': 26.353537897838738,
  'F184': 25.9050612193564,
  'F146': 27.56185043412646,
  'F213': 25.856578880139605},
 'SCA05': {'F062': 26.603874568447985,
  'F087': 26.316924339050228,
  'F106': 26.360406722355506,
  'F129': 26.360218418554034,
  'F158': 26.381458603035085,
  'F184': 25.914434497403672,
  'F146': 27.589998235890697,
  'F213': 25.86156033525695},
 'SCA06': {'F062': 26.618143254645602,
  'F087': 26.301961962140645,
  'F106': 26.379582061777512,
  'F129': 26.37764049544839,
  'F158': 26.410944089234913,
  'F184': 25.958295516758913,
  'F146': 27.614477093681774,
  'F213': 25.92238956327277},
 'SCA07': {'F062': 26.602823054353962,
  'F087': 26.27998963576242,
  'F106': 26.347816973916775,
  'F129': 26.34943664210471,
  'F158': 26.364399392198305,
  'F184': 25.89328235470171,
  'F146': 27.574317462788564,
  'F213': 25.843272454350206},
 'SCA08': {'F062': 26.64332578064669,
  'F087': 26.318843715434443,
  'F106': 26.346525706210148,
  'F129': 26.34328577388539,
  'F158': 26.363317048510034,
  'F184': 25.876582725612774,
  'F146': 27.573294137271343,
  'F213': 25.825921600792068},
 'SCA09': {'F062': 26.618062138120923,
  'F087': 26.334486892037603,
  'F106': 26.373372132078188,
  'F129': 26.37524181185253,
  'F158': 26.398340542019092,
  'F184': 25.91722989665293,
  'F146': 27.604353164548332,
  'F213': 25.867638585086347},
 'SCA10': {'F062': 26.60392004547472,
  'F087': 26.292831103813544,
  'F106': 26.34067983879334,
  'F129': 26.333189389917166,
  'F158': 26.358463200291276,
  'F184': 25.866482999676,
  'F146': 27.566868536593546,
  'F213': 25.80707360748785},
 'SCA11': {'F062': 26.614911726570316,
  'F087': 26.317206857148182,
  'F106': 26.341812692219516,
  'F129': 26.341940599414734,
  'F158': 26.372121813932033,
  'F184': 25.91389680211663,
  'F146': 27.575710616958908,
  'F213': 25.858316212477742},
 'SCA12': {'F062': 26.563700836629323,
  'F087': 26.273635556685736,
  'F106': 26.401938126264174,
  'F129': 26.40390587493991,
  'F158': 26.425347417497342,
  'F184': 25.980392616913544,
  'F146': 27.632897375905006,
  'F213': 25.947192108840337},
 'SCA13': {'F062': 26.60086712922719,
  'F087': 26.299540082700243,
  'F106': 26.31328896719395,
  'F129': 26.30775442887878,
  'F158': 26.340739049277072,
  'F184': 25.890424934284116,
  'F146': 27.54532249600629,
  'F213': 25.833771956020954},
 'SCA14': {'F062': 26.60482408369859,
  'F087': 26.30689801825794,
  'F106': 26.360612372002304,
  'F129': 26.350694765611486,
  'F158': 26.383908821058068,
  'F184': 25.926137870034644,
  'F146': 27.590671794546992,
  'F213': 25.873639156443566},
 'SCA15': {'F062': 26.665467557282568,
  'F087': 26.31650391569726,
  'F106': 26.319506431130865,
  'F129': 26.317633229230616,
  'F158': 26.34956796067756,
  'F184': 25.900834292627195,
  'F146': 27.553331648014687,
  'F213': 25.842195471619817},
 'SCA16': {'F062': 26.65989924196534,
  'F087': 26.309838416713895,
  'F106': 26.31895626524684,
  'F129': 26.31183458262937,
  'F158': 26.344038155918913,
  'F184': 25.88850712247398,
  'F146': 27.549762850721258,
  'F213': 25.84108610401785},
 'SCA17': {'F062': 26.721310797145662,
  'F087': 26.363164453654953,
  'F106': 26.402917372909357,
  'F129': 26.39757424828133,
  'F158': 26.415328720642442,
  'F184': 25.93627019144443,
  'F146': 27.628156399120467,
  'F213': 25.893594655429272},
 'SCA18': {'F062': 26.677314769458206,
  'F087': 26.332092445416055,
  'F106': 26.44304903784299,
  'F129': 26.465427332603927,
  'F158': 26.45694945298756,
  'F184': 25.977733973540342,
  'F146': 27.672322121968627,
  'F213': 25.939878334015457},
 'mean': {'F062': 26.617984134383942,
  'F087': 26.302331543505478,
  'F106': 26.354685659926012,
  'F129': 26.353176250957535,
  'F158': 26.37610209075644,
  'F184': 25.912446360764488,
  'F146': 27.584217118824064,
  'F213': 25.86337295690737},
 'median': {'F062': 26.605882739195685,
  'F087': 26.304429990199292,
  'F106': 26.34717134006346,
  'F129': 26.342613186650063,
  'F158': 26.366913004141452,
  'F184': 25.91189987914148,
  'F146': 27.575014039873736,
  'F213': 25.856923421528748},}



# Define a class to hold relevant properties for convenience
class WFI_Properties(object):

    def __init__(self, bandpass=None, sca=None):
        
        self.dark_current = 0.005
        self.saturation_limit=1e5
        self.readout_time = 3.04
        self.cds_read_noise = 16.
        self.read_noise = 11.
        self.pixel_scale = 0.11 #arcsec/pixel
        self.bias=1e3
        self.detector_size=(4096,4096)
        self.interpixel_capacitance = np.array([[0.21,  1.62,  0.20],
                [1.88, 91.59,  1.87],
                [0.21,  1.66,  0.22]]) / 100.0
        self.bandpass=bandpass


        if bandpass is None:
            self.thermal_background = None
            self.zeropoint_mag = None
            self.minzodi_background = None
        else:
            self.get_bandpass_properties(bandpass, sca)


    def get_bandpass_properties(self, bandpass, sca=None):

        if not(bandpass in wfi_filters):
            if not(bandpass in wfi_filters_alt):
                print('BANDPASS MUST BE ONE OF {}'.format(wfi_filters))
                print('BANDPASS SPECIFIC PROPERTIES REMAIN UNDEFINED\n')
                return self
                
            else:
                bandpass = wfi_filters[wfi_filters_alt.index(bandpass)]

        #if bandpass=='F213':
        #    print('WARNING: F213 ZEROPOINT IS NOT TRUSTED. USE AT YOUR OWN PERIL. \n\n')

        if sca is None:
            sca='mean'
        self.zeropoint_mag = wfi_filter_zeropoint_mags[sca][bandpass]
        
        self.thermal_background = wfi_thermal_background[bandpass]
        self.minzodi_background = wfi_minzodi_background[bandpass]
        self.bandpass=bandpass

        return self

    def get_sca_properties(self, sca):

        return self


    

    
    

    

    

